<!DOCTYPE html>
<html>
  <head>
    <title>RideGrouped</title>
    <%= favicon_link_tag "/images/favicon.ico" %>
    <%= stylesheet_link_tag    "application", :media => "all" %>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <%= javascript_include_tag "application" %>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.9.1/jquery-ui.min.js"></script>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.9.1/themes/smoothness/jquery-ui.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Play" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Inder" rel="stylesheet" type="text/css">
    <%= yield :scripts %>
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-30118084-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = 'https://ssl.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    <noscript>
      <meta http-equiv="refresh" content="0;url=<%= ENV['SERVER_HOSTNAME'] %>/nojs.html">
    </noscript>
    <%= csrf_meta_tags %>
  </head>
  <body onkeydown="body_onkeydown()">
      <div id="fb-root"></div>


<div id="facebook_overlay">
  <div id="facebook_modal">
    <div id="top_row">
      <img src="/images/rg_logo_white.png" />
      <h1 class="name">RideGrouped</h1>
    </div>
    <div id="bottom_row">
      <img id="facebook_login_button" src="/images/facebook_login.png" style="cursor:pointer"/>
      <br />
      Allows you to meet your fellow passengers
    </div>
    <%= form_for :user, :method => :put, url: '/users/facebook', :remote => true, :html => {:id => "update_fb"} do |f| %>
    <% end %>
  </div>
</div>
      <!--
      <div id="header_content">
        <div id="header_icon"></div>
        <%= yield :head %>
      </div>-->
    <%= yield %>
    <footer>
      <div class="container">
        <div class="row">
          <div class="logo span5">
            <img id="footer_logo" src="/images/rg_logo_color.png" alt="">
            <ul class="nav nav-pills">
              <li><a href="#"><h5>Terms</h5></a></li>
              <li><a href="#"><h5>Privacy</h5></a></li>
            </ul>
          </div>
          <div id="copyright" class="span2 pull-right">
            <p>Â© Covoi, LLC.</p>
          </div>
        </div>
      </div>
    </footer>
    <!--
    <div id="main">
      <div id="main_content">
        <div class="small_spacer"></div>
        <div id="message_banner">
          <% if flash[:error] %>
            <script type="text/javascript">
              $('document').ready(function() {
                display_message('<%= escape_javascript(flash[:error][:message]) %>', 'error', '<%= escape_javascript(flash[:error][:id])%>', '');
              });
            </script>
          <% elsif flash[:notice] %>
            <script type="text/javascript">
              $('document').ready(function() {
                display_message('<%= escape_javascript(flash[:notice]) %>', 'notice', 'message_banner', '');
                alert('<%= escape_javascript(flash[:notice]) %>');
              });
            </script>
          <% end %>
        </div>
        <div class="spacer"></div>
      </div>
    </div>
    <div id="footer">
      <div class="small_spacer"></div>
      <div>
        Have any questions? Notice any bugs? Email us at service@ridegrouped.com
      </div>
      <div>
        &copy; Covoi, LLC All Rights Reserved | <%= link_to "Terms of Service", "/terms_of_service.pdf" , :target => "_blank"%>
      </div>
    </div>
    -->
    <script>
  // Additional JS functions here
  window.fbAsyncInit = function() {
    FB.init({
      appId      : '235547456593765', // App ID
      channelUrl : '//localhost:3000/channel.html', // Channel File
      status     : true, // check login status
      cookie     : true, // enable cookies to allow the server to access the session
      xfbml      : true  // parse XFBML
    });

    FB.Event.subscribe('auth.authResponseChange', function(response) {
      if (response.status === 'connected') {
        //testAPI();
      } else if (response.status === 'connected') {
        FB.login();
      } else {
        FB.login();
      }
    });
  };

  // Load the SDK asynchronously
  (function(d){
     var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement('script'); js.id = id; js.async = true;
     js.src = "//connect.facebook.net/en_US/all.js";
     ref.parentNode.insertBefore(js, ref);
   }(document));

  $('#facebook_link').click(function() {
    $('#facebook_overlay').show();
  });

      $('#facebook_login_button').click(function() {
        FB.login(function(response) {
          if(response.status === 'connected') {
            $('#update_fb').submit();
            $('#facebook_overlay').hide();
            $('#facebook_link').hide();
          }
        });
      });

      function body_onkeydown() {
        if(event.keyCode == 13 || event.keyCode == 27) {
          $('#facebook_overlay').hide();
        }
      }
  </script>
  </body>
</html>
